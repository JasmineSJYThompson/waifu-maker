<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Live2D Cubism SDK Setup Guide</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            line-height: 1.6;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            color: #333;
        }
        h1, h2, h3 {
            color: #333;
        }
        code {
            background: #f4f4f4;
            padding: 2px 6px;
            border-radius: 3px;
            font-family: 'Courier New', monospace;
        }
        pre {
            background: #f4f4f4;
            padding: 15px;
            border-radius: 5px;
            overflow-x: auto;
        }
        .warning {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            padding: 15px;
            border-radius: 5px;
            margin: 20px 0;
        }
        .info {
            background: #d1ecf1;
            border: 1px solid #bee5eb;
            padding: 15px;
            border-radius: 5px;
            margin: 20px 0;
        }
        .step {
            background: #f8f9fa;
            border-left: 4px solid #007bff;
            padding: 15px;
            margin: 20px 0;
        }
    </style>
</head>
<body>
    <h1>üé≠ Live2D Cubism SDK Integration Setup</h1>
    
    <div class="warning">
        <strong>‚ö†Ô∏è Important:</strong> Live2D Cubism SDK requires a commercial license for production use. 
        This setup guide is for development and testing purposes only.
    </div>

    <h2>Prerequisites</h2>
    <ul>
        <li>Live2D Cubism SDK for Web (requires license from Live2D)</li>
        <li>PIXI.js library</li>
        <li>A Live2D model file (.model3.json)</li>
    </ul>

    <h2>Step 1: Install Dependencies</h2>
    <div class="step">
        <h3>Install PIXI.js</h3>
        <pre><code>npm install pixi.js</code></pre>
        
        <h3>Install Live2D Cubism SDK</h3>
        <p>Download the Live2D Cubism SDK for Web from the official Live2D website and extract it to your project.</p>
    </div>

    <h2>Step 2: Add SDK Scripts to index.html</h2>
    <div class="step">
        <p>Add the following scripts to your <code>public/index.html</code> file:</p>
        <pre><code>&lt;!-- PIXI.js --&gt;
&lt;script src="https://cdnjs.cloudflare.com/ajax/libs/pixi.js/7.3.2/pixi.min.js"&gt;&lt;/script&gt;

&lt;!-- Live2D Cubism SDK --&gt;
&lt;script src="path/to/live2dcubismcore.js"&gt;&lt;/script&gt;
&lt;script src="path/to/pixi-live2d-display.js"&gt;&lt;/script&gt;</code></pre>
    </div>

    <h2>Step 3: Initialize Live2D Core</h2>
    <div class="step">
        <p>In your VTuber component, add the Live2D core initialization:</p>
        <pre><code>// Initialize Live2D Core
await PIXI.live2d.config.motionFadingDuration = 0;
await PIXI.live2d.config.motionFadingStrategy = 0;

// Set up the model
const model = await PIXI.live2d.Live2DModel.from('path/to/your/model.model3.json');
app.stage.addChild(model);

// Position and scale the model
model.scale.set(0.5);
model.position.set(400, 300);
model.anchor.set(0.5, 0.5);</code></pre>
    </div>

    <h2>Step 4: Implement Lip-Sync</h2>
    <div class="step">
        <p>Update the <code>updateLive2DParameters</code> function in VTuber.js:</p>
        <pre><code>const updateLive2DParameters = (lipSyncValue) => {
  if (model && model.internalModel) {
    // Update mouth opening parameter
    model.internalModel.coreModel.setParameterValueById('ParamMouthOpen', lipSyncValue);
    
    // Update other parameters based on audio analysis
    model.internalModel.coreModel.setParameterValueById('ParamEyeLOpen', 1.0);
    model.internalModel.coreModel.setParameterValueById('ParamEyeROpen', 1.0);
    
    // Add breathing animation
    const time = Date.now() / 1000;
    const breathing = Math.sin(time * 2) * 0.1 + 0.9;
    model.internalModel.coreModel.setParameterValueById('ParamBreath', breathing);
  }
};</code></pre>
    </div>

    <h2>Step 5: Add Model Loading</h2>
    <div class="step">
        <p>Replace the placeholder model loading with actual Live2D model loading:</p>
        <pre><code>const loadLive2DModel = async (app) => {
  try {
    console.log('Loading Live2D model...');
    
    // Load the Live2D model
    const model = await PIXI.live2d.Live2DModel.from('/models/your-model.model3.json');
    
    // Add model to the stage
    app.stage.addChild(model);
    
    // Position and scale
    model.scale.set(0.5);
    model.position.set(400, 300);
    model.anchor.set(0.5, 0.5);
    
    // Store model reference
    setLive2dModel(model);
    setModelLoaded(true);
    
    console.log('Live2D model loaded successfully');
    
  } catch (error) {
    console.error('Failed to load Live2D model:', error);
    setError('Failed to load Live2D model.');
  }
};</code></pre>
    </div>

    <h2>Step 6: Add Model Directory</h2>
    <div class="step">
        <p>Create a <code>public/models/</code> directory and place your Live2D model files there:</p>
        <pre><code>public/
  models/
    your-model.model3.json
    your-model.model3.moc3
    your-model.physics3.json
    textures/
      texture_00.png
      texture_01.png
    motions/
      idle.motion3.json
      talking.motion3.json</code></pre>
    </div>

    <h2>Step 7: Enhanced Audio Analysis</h2>
    <div class="step">
        <p>Improve the audio analysis for better lip-sync:</p>
        <pre><code>const startLipSyncAnimation = () => {
  if (!live2dApp || !audioAnalyser || !live2dModel) return;

  const animate = () => {
    if (!isSpeaking) return;

    // Get audio data
    const dataArray = new Uint8Array(audioAnalyser.frequencyBinCount);
    audioAnalyser.getByteFrequencyData(dataArray);

    // Calculate different frequency bands
    const lowFreq = dataArray.slice(0, 8).reduce((a, b) => a + b) / 8;
    const midFreq = dataArray.slice(8, 16).reduce((a, b) => a + b) / 8;
    const highFreq = dataArray.slice(16, 24).reduce((a, b) => a + b) / 8;

    // Map to Live2D parameters
    const lipSyncValue = Math.min(midFreq / 128, 1.0);
    const eyeBlink = Math.random() < 0.01 ? 0 : 1; // Random blinking
    const headTilt = Math.sin(Date.now() / 2000) * 0.1;

    // Update model parameters
    updateLive2DParameters(lipSyncValue, eyeBlink, headTilt);

    requestAnimationFrame(animate);
  };

  animate();
};</code></pre>
    </div>

    <h2>Step 8: Add Expressions and Motions</h2>
    <div class="step">
        <p>Add support for expressions and motions:</p>
        <pre><code>// Play expression
const playExpression = (expressionId) => {
  if (live2dModel) {
    live2dModel.expression(expressionId);
  }
};

// Play motion
const playMotion = (motionGroup, motionId) => {
  if (live2dModel) {
    live2dModel.motion(motionGroup, motionId);
  }
};

// Example usage
playExpression('happy');
playMotion('idle', 'idle_01');</code></pre>
    </div>

    <div class="info">
        <h3>üéØ Next Steps</h3>
        <ul>
            <li>Download a free Live2D model for testing (check Live2D's official site)</li>
            <li>Customize the model parameters based on your specific model</li>
            <li>Add more expressions and motions</li>
            <li>Implement gesture recognition for more interactive animations</li>
            <li>Add camera controls for different viewing angles</li>
        </ul>
    </div>

    <div class="warning">
        <h3>‚ö†Ô∏è Troubleshooting</h3>
        <ul>
            <li><strong>CORS errors:</strong> Make sure your model files are served from the same domain</li>
            <li><strong>Model not loading:</strong> Check the file paths and ensure all required files are present</li>
            <li><strong>No lip-sync:</strong> Verify that your model has the correct parameter IDs</li>
            <li><strong>Performance issues:</strong> Consider reducing the model complexity or canvas resolution</li>
        </ul>
    </div>

    <h2>Resources</h2>
    <ul>
        <li><a href="https://www.live2d.com/en/download/cubism-sdk/download-web/" target="_blank">Live2D Cubism SDK for Web</a></li>
        <li><a href="https://pixijs.io/" target="_blank">PIXI.js Documentation</a></li>
        <li><a href="https://github.com/guansss/pixi-live2d-display" target="_blank">PIXI Live2D Display</a></li>
        <li><a href="https://www.live2d.com/en/download/sample-data/" target="_blank">Live2D Sample Models</a></li>
    </ul>
</body>
</html> 